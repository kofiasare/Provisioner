---
- name: Setup before gathering facts.
  hosts: staging
  gather_facts: no
  roles:
    - setup

- name: Provision a staging server for veryfy api.
  hosts: staging
  roles:
    - nginx
    - redis
    - role: postgres
      vars:
        pg_user: "veryfy"
        pg_user_password: "{{ pg_user_pass }}"
    - rails-config
    - rbenv
    - role: weareinteractive.environment
      vars:
        environment_config:
          PATH: "/usr/local/rbenv/shims:/usr/local/rbenv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin"
      become: yes
      become_user: root
